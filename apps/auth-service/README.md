# Auth-Service

**统一认证与权限中心**  
为企业级应用提供安全、灵活、可扩展的用户认证、权限管理和多租户支持。

---

## 功能概览

- **用户认证**：支持用户名密码登录、图形验证码、登录失败锁定。
- **单点登录（SSO）**：支持企业内部系统间的单点登录（JWT方式），可扩展对接第三方平台。
- **多租户管理**：每个租户（公司/组织）拥有独立的用户、角色、权限体系。
- **角色与权限**：基于角色的权限控制（RBAC），支持细粒度资源授权。
- **用户组管理**：支持用户分组、批量授权。
- **审计日志**：所有关键操作均有详细审计，便于安全追溯。
- **国际化**：支持中英文切换。
- **高可用架构**：支持分布式、微服务部署。

---

## 技术架构

- **后端框架**：NestJS（TypeScript）
- **数据库**：PostgreSQL
- **缓存/会话**：Redis
- **权限引擎**：Casbin
- **认证协议**：JWT（Json Web Token）
- **日志**：Winston
- **微服务通信**：支持 TCP、gRPC 等

---

## 典型应用场景

- 企业/组织内部统一身份认证
- SaaS 平台多租户用户与权限管理
- 微服务架构下的统一认证与授权
- 需要安全审计和权限追溯的业务系统

---

## 主要接口示例

### 1. 用户认证与登录

- **登录**

  ```
  POST /auth/login
  Body: { tenantSlug, username, password, captchaId, captchaText }
  返回: { accessToken, refreshToken, sessionId }
  ```

- **刷新Token**

  ```
  POST /auth/refresh
  Body: { refreshToken, sessionId }
  返回: { accessToken, refreshToken, sessionId }
  ```

- **登出**

  ```
  POST /auth/logout
  Header: Authorization: Bearer <accessToken>
  Body: { sessionId }
  返回: { success: true }
  ```

- **单点登录（SSO）**
  ```
  POST /auth/sso
  Body: { ssoToken }
  返回: { accessToken, refreshToken, sessionId }
  ```

### 2. 用户管理

- **创建用户**、**查询用户**、**更新用户**、**删除用户**、**修改用户状态**、**修改个人信息**、**修改密码**等，均通过微服务消息或 RESTful API 提供。

### 3. 多租户管理

- **创建/更新/删除租户**
- **查询租户信息、修改租户状态**

### 4. 角色与权限

- **角色管理**：增删改查角色，分配角色权限
- **权限管理**：查询/分配资源权限
- **用户组管理**：增删改查用户组，分配组权限

---

## 权限模型说明

- **多租户隔离**：每个租户拥有独立的用户、角色、权限空间。
- **RBAC**：基于角色的访问控制，支持资源-动作的细粒度授权。
- **Casbin**：国际主流权限引擎，支持灵活扩展。

---

## 安全与合规

- **登录安全**：支持验证码、登录失败锁定、密码强度校验。
- **Token 安全**：支持黑名单机制，防止 token 被盗用。
- **操作审计**：所有关键操作均有详细日志，便于合规和追溯。

## 常见问题

- **Q：支持微信、钉钉等第三方平台登录吗？**  
  A：当前支持企业内部 SSO，如需对接微信/钉钉等标准第三方平台，可扩展 OAuth2.0 协议。

- **Q：如何保障权限安全？**  
  A：权限模型支持多租户隔离、角色分配、细粒度资源控制，所有操作均有审计日志。

---

## 贡献与支持

欢迎提交 Issue 和 PR，或联系维护团队获取更多支持！
